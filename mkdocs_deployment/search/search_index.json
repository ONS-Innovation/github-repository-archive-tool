{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"GitHub Repository Archive Tool","text":""},{"location":"#overview","title":"Overview","text":"<p>This project contains a Python Flask application which is used to archive unused GitHub repositories for an organisation. The tool interacts with the GitHub RESTful API to perform actions on an organisation's repositories.</p> <p>Please Note: This project is a Proof of concept and may not comply with Civil Service/ONS best practices. This tool is only being used by a limited number of users.</p>"},{"location":"#techstack-overview","title":"Techstack Overview","text":""},{"location":"#flask","title":"Flask","text":"<p>Flask is a Python web framework which can create web applications, APIs and microservices. Flask has been chosen because of its simplicity and flexibility. In addition to this, Flask is widely used across ONS and therefore has a strong support network if needed. Other web frameworks such as Django were considered, however Flask was decided upon because of the project's small size and the speed at which the proof of concept needed to be developed.</p>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>This project uses 4 major components:</p> <ul> <li>The App</li> <li>Data Retrieval</li> <li>The Storage Interface</li> <li>The GitHub API Toolkit (stored in another repository - Repository Link)</li> </ul>"},{"location":"#the-app","title":"The App","text":"<p>This component is responsible for the majority of the Flask App. It contains all of the routing and UI processes. It also retrieves information using the other 3 components. The App uses the data retrieval component when finding the initial list of repositories, the storage interface when reading and writing data to S3 and the GitHub API toolkit when making direct calls to the GitHub API.</p>"},{"location":"#data-retrieval","title":"Data Retrieval","text":"<p>This component is used to get repository information from GitHub. The component uses the GitHub API Toolkit to make these requests. Data retrieval has 2 main processes, one for getting a list of repositories and one for contributors to a repository. Data Retrieval acts as a middle ground between <code>app.py</code> and the toolkit as the logic is too big and complex to be held around the UI and Flask functionality (increasing code readability).</p>"},{"location":"#the-storage-interface","title":"The Storage Interface","text":"<p>This component deals with any interaction the app has with both local and cloud storage, as well as making sure the local files match their AWS counterparts. All storage interactions the tool has works by making changes to local files, then uploading those to S3. If those local files do not exist or are outdated by another instance, they're downloaded from S3. This reduces the number of times changes are made to S3 as the local files are only uploaded once a bulk of actions has taken place (i.e when archiving repositories, instead of changing the S3 file for each repository, all changes are made locally then the S3 file is changed once).</p>"},{"location":"#the-github-api-toolkit","title":"The GitHub API Toolkit","text":"<p>This component is an imported library which is shared across multiple GitHub tools. The toolkit allows applications to make authenticated requests to the GitHub API. It is imported and used in the Lambda function.</p>"},{"location":"#high-level-data-overview","title":"High Level Data Overview","text":"<p>The app's dataset can be divided into 3 parts:</p> <ul> <li>Repositories Ready for Archive</li> <li>Archived Repositories</li> <li>Recently Added Repositories</li> </ul>"},{"location":"#repositories-ready-for-archive","title":"Repositories Ready for Archive","text":"<p>This section of the dataset gets stored in <code>repositories.json</code>. It contains a list of repositories which have been added to the system and are ready to be archived. Each repository within the list has the following information stored about it:</p> <ul> <li>Repository Name</li> <li>Repository Type (i.e public, private or internal)</li> <li>A list of GitHub Contributors</li> <li>The API endpoint URL for that repository</li> <li>When the repository was last committed to</li> <li>When the repository was added to the system</li> <li>An exemption date (the repository will not be archived until after this date)</li> <li>An exemption reason</li> <li>A Name and Email for who made the repository exempt</li> </ul> <p>JSON Skeleton:</p> <pre><code>[\n    ...\n    {\n        \"name\": &lt;string&gt;,\n        \"type\": &lt;string&gt;,\n        \"contributors\": [\n            ...\n            {\n                \"avatar\": &lt;string&gt;,\n                \"login\": &lt;string&gt;,\n                \"url\": &lt;string&gt;,\n                \"contributions\": &lt;int&gt;\n            },\n            ...\n        ],\n        \"apiUrl\": &lt;string&gt;,\n        \"lastCommit\": &lt;string&gt;,\n        \"dateAdded\": &lt;string&gt;,\n        \"exemptUntil\": &lt;string&gt;,\n        \"exemptReason\": &lt;string&gt;,\n        \"exemptBy\": {\n            \"name\": &lt;string&gt;,\n            \"email\": &lt;string&gt;\n        }\n    },\n    ...\n]\n</code></pre> <p>JSON Example:</p> <pre><code>[\n    ...\n    {\n        \"name\": \"github-repository-archive-tool\",\n        \"type\": \"public\",\n        \"contributors\": [\n            ...\n            {\n                \"avatar\": \"https://avatars.githubusercontent.com/u/99291477?v=4\",\n                \"login\": \"TotalDwarf03\",\n                \"url\": \"https://github.com/TotalDwarf03\",\n                \"contributions\": 141\n            },\n            {\n                \"avatar\": \"https://avatars.githubusercontent.com/u/88480716?v=4\",\n                \"login\": \"gibbardsteve\",\n                \"url\": \"https://github.com/gibbardsteve\",\n                \"contributions\": 15\n            },\n            {\n                \"avatar\": \"https://avatars.githubusercontent.com/in/29110?v=4\",\n                \"login\": \"dependabot[bot]\",\n                \"url\": \"https://github.com/apps/dependabot\",\n                \"contributions\": 1\n            },\n            ...\n        ],\n        \"apiUrl\": \"https://api.github.com/repos/ONS-Innovation/github-repository-archive-tool\",\n        \"lastCommit\": \"2024-07-09\",\n        \"dateAdded\": \"2024-07-11\",\n        \"exemptUntil\": \"1900-01-01\",\n        \"exemptReason\": \"\",\n        \"exemptBy\": {\n            \"name\": \"\",\n            \"email\": \"\"\n        }\n    },\n    ...\n]\n</code></pre>"},{"location":"#archive-repositories","title":"Archive Repositories","text":"<p>This section of the dataset is stored in <code>archived.json</code>. It contains a list of batches of repositores which have been archived. Each batch contains the following information:</p> <ul> <li>Batch ID</li> <li>The data which the batch was archived</li> <li> <p>A list of repositories which have been archived</p> <p>Each repository entry within that list contains:</p> <ul> <li>Repository Name</li> <li>The URL of the API endpoint for that repository</li> <li>The archive status of that repositories (i.e Success or Failed)</li> <li>A status message (i.e an error code and description if Failed)</li> </ul> </li> </ul> <p>JSON Skeleton:</p> <pre><code>[\n    ...\n    {\n        \"batchID\": &lt;int&gt;,\n        \"date\": &lt;string&gt;,\n        \"repos\": [\n            ...\n            {\n                \"name\": &lt;string&gt;,\n                \"apiurl\": &lt;string&gt;,\n                \"status\": &lt;string&gt;,\n                \"message\": &lt;string&gt;\n            },\n            {\n                \"name\": &lt;string&gt;,\n                \"apiurl\": &lt;string&gt;,\n                \"status\": &lt;string&gt;,\n                \"message\": &lt;string&gt;\n            },\n            ...\n        ]\n    }\n    ...\n]\n</code></pre> <p>JSON Example:</p> <pre><code>[\n    ...\n    {\n        \"batchID\": 2,\n        \"date\": \"2024-07-15\",\n        \"repos\": [\n            ...\n            {\n                \"name\": \"github-repository-archive-tool\",\n                \"apiurl\": \"https://api.github.com/repos/ONS-Innovation/github-repository-archive-tool\",\n                \"status\": \"Success\",\n                \"message\": \"Repository Archived Successfully.\"\n            },\n            {\n                \"name\": \"github-policy-dashboard\",\n                \"apiurl\": \"https://api.github.com/repos/ONS-Innovation/github-policy-dashboard\",\n                \"status\": \"Failed\",\n                \"message\": \"Error: 404 Repository not found.\"\n            },\n            ...\n        ]\n    }\n    ...\n]\n</code></pre>"},{"location":"#recently-added-repositories","title":"Recently Added Repositories","text":"<p>This section of the dataset gets stored in <code>recently_added.html</code>. This is a static HTML page containing a list of repositories which were most recently added to the system. Each repository has its name, a link to its GitHub page and a link to mark that repository as exempt within the tool. This file would get downloaded by the user of the tool so it can be distributed to users of ONSDigital to ensure only unused repositories are archived.</p> <p>Example file:</p> <pre><code>&lt;h1&gt;Repositories to be Archived&lt;/h1&gt;\n&lt;ul&gt;\n    &lt;li&gt;github-copilot-usage-dashboard (&lt;a href='https://github.com/ONS-Innovation/github-copilot-usage-dashboard' target='_blank'&gt;View Repository&lt;/a&gt; - &lt;a href='http://localhost:5000//set_exempt_date?repoName=github-copilot-usage-dashboard' target='_blank'&gt;Mark Repository as Exempt&lt;/a&gt;)&lt;/li&gt;\n    &lt;li&gt;github-repository-archive-tool (&lt;a href='https://github.com/ONS-Innovation/github-repository-archive-tool' target='_blank'&gt;View Repository&lt;/a&gt; - &lt;a href='http://localhost:5000//set_exempt_date?repoName=github-repository-archive-tool' target='_blank'&gt;Mark Repository as Exempt&lt;/a&gt;)&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;p&gt;\n    Total Repositories: 2\n&lt;/p&gt;\n&lt;p&gt;\n    These repositories will be archived in &lt;b&gt;30 days&lt;/b&gt;, unless marked as exempt.\n&lt;/p&gt;\n</code></pre> <p>Please Note: The above example has been formatted manually. The contents of the real HTML file contains no whitespace, new lines or indentation.</p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>To setup and use the project, please refer to the README.</p>"},{"location":"documentation/","title":"Documentation","text":"<p>This site uses MkDocs to build its documentation and GitHub Pages for hosting.</p>"},{"location":"documentation/#format","title":"Format","text":"<p>Documentation within this project follows the following pattern:</p> <ul> <li>A <code>README.md</code> for each component</li> <li>A <code>/docs</code> folder for the project</li> </ul> <p>Each <code>README.md</code> should contain:</p> <ul> <li>A description of what the component is/does</li> <li>A list of any prerequisites</li> <li>Setup instructions</li> <li>Execution instructions</li> <li>Deployment instructions</li> </ul> <p>The <code>/docs</code> folder should contain:</p> <ul> <li>A description of what the project is</li> <li>An overview of how the everything fits together in the project</li> <li>An explanation of the tech stack</li> <li>Details of the underlying dataset</li> </ul> <p>A majority of the information should reside within the <code>/docs</code> directory over the <code>README</code>. The <code>README</code>s in this project should be kept for concise instructions on how to use each component. Any detailed explanation should be kept within <code>/docs</code>.</p>"},{"location":"documentation/#updating-mkdocs-deployment","title":"Updating MkDocs Deployment","text":"<p>If changes are made within <code>/docs</code>, the GitHub Pages deployment will need to be updated. Assuming you have already installed MkDocs and Material for MkDocs, do the following:</p> <ol> <li> <p>Navigate to the projects root directory.</p> </li> <li> <p>Delete the existing <code>/mkdocs_deployment</code> directory.</p> </li> <li> <p>Build the MkDocs deployment.</p> </li> </ol> <pre><code>mkdocs build\n</code></pre> <ol> <li> <p>Rename the <code>/site</code> directory to <code>/mkdocs_deployment</code>. This allows git to track the build so GitHub Pages can redeploy it.</p> </li> <li> <p>Commit and Push changes.</p> </li> </ol> <p>Once completed, a GitHub Action will redeploy the new build to GitHub Pages.</p>"}]}